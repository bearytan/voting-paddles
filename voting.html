<!DOCTYPE html>
<html>
<head>
    <title>Voting</title>
</head>
<body>
    <h1>Vote for the Couple!</h1>
    <div id="votes"></div>
    <button onclick="vote('Bride')">Vote for Bride</button>
    <button onclick="vote('Groom')">Vote for Groom</button>
    <button onclick="resetVotes()" id="resetButton" style="display:none;">Reset Votes</button>
    <script>
        const scriptURL = "https://script.google.com/macros/s/AKfycbw29UzuHm7VMRuAURd8Ocg30lzCJ2OXg_BdePGAv6Enj3suH4dHgmcOJfJ1mfXOToMcOQ/exec"; // Replace with your web app URL
        const votesDiv = document.getElementById("votes");
        const resetButton = document.getElementById("resetButton");
        let isAdmin = false;

        function updateVotes(votes) {
            votesDiv.innerHTML = "";
            for (const candidate in votes) {
                votesDiv.innerHTML += `<p>${candidate}: ${votes[candidate]}</p>`;
            }
        }

        function getInitialVotes(){
            fetch(scriptURL + "?action=getVotes")
                .then(response => response.json())
                .then(votes => updateVotes(votes));
        }

        function vote(candidate) {
            fetch(scriptURL + "?action=vote&candidate=" + candidate)
                .then(() => getInitialVotes());
        }

        function resetVotes(){
            if(isAdmin){
                fetch(scriptURL + "?action=reset")
                    .then(() => getInitialVotes());
            }
        }

        function streamVotes(){
            const evtSource = new EventSource(scriptURL + "?action=stream");
            evtSource.onmessage = function(event) {
                updateVotes(JSON.parse(JSON.parse(event.data)));
            }
        }

        getInitialVotes();
        streamVotes();

        //Admin check (Simple example, improve security in production)
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('admin') === 'true') {
            isAdmin = true;
            resetButton.style.display = "block";
        }
    </script>
</body>
</html>
