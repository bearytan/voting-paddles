<!DOCTYPE html>
<html>
<head>
    <title>Voting</title>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-analytics-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/uuid/8.3.2/uuidv4.min.js"></script>
    <style> /* ... (your CSS) ... */ </style>
</head>
<body>
    <h1>Vote for the Couple!</h1>
    <div class="vote-container">
        <div class="candidate" onclick="vote('bride')">
            <img src="bride.jpg" alt="Bride">
            <div class="vote-count" id="bride-count">0</div>
        </div>
        <div class="candidate" onclick="vote('groom')">
            <img src="groom.jpg" alt="Groom">
            <div class="vote-count" id="groom-count">0</div>
        </div>
    </div>
    <button onclick="resetVotes()" id="resetButton" style="display:none;">Reset Votes</button>

    <script>
        // Your Firebase config
        const firebaseConfig = {
  apiKey: "AIzaSyBngkD6yonIx2mI7oiC9BOfXBG-9PekVHE",
  authDomain: "wedding-game-8c6b9.firebaseapp.com",
  databaseURL: "https://wedding-game-8c6b9-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "wedding-game-8c6b9",
  storageBucket: "wedding-game-8c6b9.firebasestorage.app",
  messagingSenderId: "500082708201",
  appId: "1:500082708201:web:32d24f1167227f3e686a78"
};

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const analytics = firebase.getAnalytics();
        const db = firebase.database(app);

        let votesRef; // Declare votesRef outside

        firebase.database().ref('.info/connected').on('value', function(snapshot) {
            if (snapshot.val() === true) {
                votesRef = firebase.database().ref('votes');
                hasVotedRef = firebase.database().ref('hasVoted');

                votesRef.on('value', (snapshot) => {
                    const votes = snapshot.val() || { bride: 0, groom: 0 };
                    updateVotes(votes);
                });
            }
        });

        const votesDiv = document.getElementById("votes");
        const resetButton = document.getElementById("resetButton");
        let isAdmin = false;

        function updateVotes(votes) {
            document.getElementById("bride-count").textContent = votes.bride || 0;
            document.getElementById("groom-count").textContent = votes.groom || 0;
        }

        function vote(candidate) {
            // ... (Your vote function - no changes needed here)
            let voterId = localStorage.getItem('voterId');

            if (!voterId) {
                voterId = uuidv4();
                localStorage.setItem('voterId', voterId);
            }

            const userHasVotedRef = hasVotedRef.child(voterId);

            userHasVotedRef.once('value', (snapshot) => {
                if (snapshot.exists()) {
                    alert("You have already voted.");
                    return;
                } else {
                    votesRef.child(candidate).transaction(current_value => {
                        return (current_value || 0) + 1;
                    }).then(() => {
                        userHasVotedRef.set(true);
                    }).catch((error) => {
                        console.error("Transaction failed: ", error);
                        alert("An error occurred while voting. Please try again later.");
                    });
                }
            });
        }

        function resetVotes() {
            if (isAdmin) {
                votesRef.set({ bride: 0, groom: 0 });
                hasVotedRef.set(null);
            }
        }

        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('admin') === 'true') {
            isAdmin = true;
            resetButton.style.display = "block";
        }
    </script>
</body>
</html>
